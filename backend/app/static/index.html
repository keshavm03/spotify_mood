<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Spotify Mood Tracker</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { margin: 5px; padding: 10px; }
        table { border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; }
        th { background-color: #eee; }
    </style>
</head>
<body>

<h1>Spotify Mood Tracker</h1>

<button id="loginBtn">Login with Spotify</button>
<button id="songsBtn">See Songs Log</button>
<button id="moodsBtn">See Moods</button>

<div id="output"></div>

<script>
    const backendBase = "http://127.0.0.1:8000";

    document.getElementById("loginBtn").addEventListener("click", () => {
        window.location.href = backendBase + "/auth/login"; // Redirect to backend login
    });

    document.getElementById("songsBtn").addEventListener("click", async () => {
        try {
            const res = await fetch(backendBase + '/tracks/recent-tracks?access_token=' + token);
            const data = await res.json();
            let html = "<h2>Recent Songs</h2><table><tr><th>Name</th><th>Artist</th><th>Played At</th></tr>";
            data.forEach(song => {
                html += `<tr><td>${song.name}</td><td>${song.artist}</td><td>${song.played_at}</td></tr>`;
            });
            html += "</table>";
            document.getElementById("output").innerHTML = html;
        } catch (err) {
            console.error(err);
            document.getElementById("output").innerHTML = "Error fetching songs.";
        }
    });

    document.getElementById("moodsBtn").addEventListener("click", async () => {
        try {
            const res = await fetch(backendBase + "/tracks/moods");
            const data = await res.json();
            let html = "<h2>Moods</h2><ul>";
            data.forEach(mood => {
                html += `<li>${mood.song} → ${mood.mood}</li>`;
            });
            html += "</ul>";
            document.getElementById("output").innerHTML = html;
        } catch (err) {
            console.error(err);
            document.getElementById("output").innerHTML = "Error fetching moods.";
        }
    });
</script>

</body>
</html> -->

<!-- 
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Spotify Mood Tracker</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { margin: 5px; padding: 10px; }
        table { border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; }
        th { background-color: #eee; }
    </style>
</head>
<body>

<h1>Spotify Mood Tracker</h1>

<button id="loginBtn">Login with Spotify</button>
<button id="songsBtn">See Songs Log</button>
<button id="moodsBtn">See Moods</button>

<div id="output"></div>

<script>
    const backendBase = "http://127.0.0.1:8000";

    // Check if we were redirected back from Spotify with an access token in the URL
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has("access_token")) {
        const token = urlParams.get("access_token");
        localStorage.setItem("spotify_access_token", token);
        window.history.replaceState({}, document.title, "/static/index.html"); // Clean URL
    }

    const token = localStorage.getItem("spotify_access_token");

    document.getElementById("loginBtn").addEventListener("click", () => {
        window.location.href = backendBase + "/auth/login"; // Redirect to backend login
    });

    document.getElementById("songsBtn").addEventListener("click", async () => {
        if (!token) {
            document.getElementById("output").innerHTML = "Please login first.";
            return;
        }
        try {
            const res = await fetch(`${backendBase}/tracks/recent-tracks?access_token=${token}&limit=20`);
            const data = await res.json();

            if (data.error) {
                document.getElementById("output").innerHTML = "Error: " + data.error;
                return;
            }

            const tracks = data.tracks || [];
            let html = "<h2>Recent Songs</h2><table><tr><th>Name</th><th>Artists</th><th>Played At</th></tr>";
            tracks.forEach(song => {
                html += `<tr><td>${song.name}</td><td>${song.artists.join(", ")}</td><td>${song.played_at}</td></tr>`;
            });
            html += "</table>";
            document.getElementById("output").innerHTML = html;
        } catch (err) {
            console.error(err);
            document.getElementById("output").innerHTML = "Error fetching songs.";
        }
    });

    document.getElementById("moodsBtn").addEventListener("click", async () => {
        if (!token) {
            document.getElementById("output").innerHTML = "Please login first.";
            return;
        }
        try {
            const res = await fetch(`${backendBase}/tracks/moods?access_token=${token}`);
            const data = await res.json();

            if (data.error) {
                document.getElementById("output").innerHTML = "Error: " + data.error;
                return;
            }

            let html = "<h2>Moods</h2><ul>";
            data.forEach(mood => {
                html += `<li>${mood.song} → ${mood.mood}</li>`;
            });
            html += "</ul>";
            document.getElementById("output").innerHTML = html;
        } catch (err) {
            console.error(err);
            document.getElementById("output").innerHTML = "Error fetching moods.";
        }
    });
</script>

</body>
</html> -->


<!-- 
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Spotify Mood Tracker</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { margin: 5px; padding: 10px; }
        table { border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; }
        th { background-color: #eee; }
    </style>
</head>
<body>

<h1>Spotify Mood Tracker</h1>

<button id="loginBtn">Login with Spotify</button>
<button id="songsBtn">See Songs Log</button>
<button id="moodsBtn">See Moods</button>

<div id="output"></div>

<script>
    const backendBase = "http://127.0.0.1:8000";

    // STEP 1 — Detect access_token from redirect and store it
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has("access_token")) {
        const token = urlParams.get("access_token");
        localStorage.setItem("spotify_access_token", token);
        console.log("Token stored:", token);
        window.history.replaceState({}, document.title, "/static/index.html"); // Clean URL
    }

    // STEP 2 — Always check token in storage
    let token = localStorage.getItem("spotify_access_token");

    document.getElementById("loginBtn").addEventListener("click", () => {
        window.location.href = backendBase + "/auth/login";
    });

    document.getElementById("songsBtn").addEventListener("click", async () => {
        token = localStorage.getItem("spotify_access_token"); // refresh token variable
        if (!token) {
            document.getElementById("output").innerHTML = "Please login first.";
            return;
        }
        try {
            const res = await fetch(`${backendBase}/tracks/recent-tracks?access_token=${token}&limit=20`);
            const data = await res.json();

            if (data.error) {
                document.getElementById("output").innerHTML = "Error: " + data.error;
                return;
            }

            const tracks = data.tracks || [];
            let html = "<h2>Recent Songs</h2><table><tr><th>Name</th><th>Artists</th><th>Played At</th></tr>";
            tracks.forEach(song => {
                html += `<tr><td>${song.name}</td><td>${song.artists.join(", ")}</td><td>${song.played_at}</td></tr>`;
            });
            html += "</table>";
            document.getElementById("output").innerHTML = html;
        } catch (err) {
            console.error(err);
            document.getElementById("output").innerHTML = "Error fetching songs.";
        }
    });

    document.getElementById("moodsBtn").addEventListener("click", async () => {
        token = localStorage.getItem("spotify_access_token");
        if (!token) {
            document.getElementById("output").innerHTML = "Please login first.";
            return;
        }
        try {
            const res = await fetch(`${backendBase}/tracks/moods?access_token=${token}`);
            const data = await res.json();

            if (data.error) {
                document.getElementById("output").innerHTML = "Error: " + data.error;
                return;
            }

            let html = "<h2>Moods</h2><ul>";
            data.forEach(mood => {
                html += `<li>${mood.song} → ${mood.mood}</li>`;
            });
            html += "</ul>";
            document.getElementById("output").innerHTML = html;
        } catch (err) {
            console.error(err);
            document.getElementById("output").innerHTML = "Error fetching moods.";
        }
    });
</script>

</body>
</html> -->


<!-- 

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Auth Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Spotify Music App</h1>
    <button id="loginBtn">Login with Spotify</button>
    <button id="getSongsBtn" style="display:none;">Get My Songs</button>

    <div id="songsList"></div>

    <script>
        // When redirected back from Spotify, check if access_token is in URL
        const params = new URLSearchParams(window.location.search);
        const accessToken = params.get("access_token");

        if (accessToken) {
            // Save token to localStorage
            localStorage.setItem("spotify_access_token", accessToken);
            // Clean URL so token is not visible in address bar
            window.history.replaceState({}, document.title, "/");
        }

        // Check if token exists
        const storedToken = localStorage.getItem("spotify_access_token");

        const loginBtn = document.getElementById("loginBtn");
        const getSongsBtn = document.getElementById("getSongsBtn");

        if (storedToken) {
            loginBtn.style.display = "none";
            getSongsBtn.style.display = "inline-block";
        }

        // Login button click -> redirect to backend login route
        loginBtn.addEventListener("click", () => {
            window.location.href = "/auth/login"; // Your backend login route
        });

        // Get Songs button click
        getSongsBtn.addEventListener("click", async () => {
            const token = localStorage.getItem("spotify_access_token");
            if (!token) {
                alert("Please login first!");
                return;
            }

            const response = await fetch("https://api.spotify.com/v1/me/top/tracks", {
                headers: {
                    Authorization: `Bearer ${token}`
                }
            });

            if (response.ok) {
                const data = await response.json();
                displaySongs(data.items);
            } else {
                alert("Failed to fetch songs. Maybe token expired.");
            }
        });

        // Display fetched songs
        function displaySongs(songs) {
            const songsList = document.getElementById("songsList");
            songsList.innerHTML = "";
            songs.forEach(song => {
                const div = document.createElement("div");
                div.textContent = `${song.name} — ${song.artists.map(a => a.name).join(", ")}`;
                songsList.appendChild(div);
            });
        }
    </script>
</body>
</html> -->


<!DOCTYPE html>
<html>
<head>
    <title>Spotify Login</title>
</head>
<body>
    <h1>Welcome to the Spotify App</h1>
    <button id="login-btn">Login with Spotify</button>

    <script>
        document.getElementById("login-btn").addEventListener("click", () => {
            // Redirect to your backend route that starts Spotify OAuth
            window.location.href = "/auth/login"; // This should be your backend login route
        });
    </script>
</body>
</html>
